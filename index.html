<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Capital de Giro PEAC FGI</title>
    <link rel="stylesheet" href="style.css">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2GNJGRKPE7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-2GNJGRKPE7');
    </script>
</head>
<body>

    <header>
        <h1>Calculadora de Capital de Giro PEAC FGI</h1>
        <p class="subtitle">Agência Empresa Teresina</p>
    </header>

    <main>
        <section id="simulator-form">
            <form id="loan-form">
                <div class="form-header">
                    <h2>Informações da Simulação</h2>
                    <div class="edit-wrapper">
                        <button type="button" id="edit-btn" disabled>Editar</button>
                        <div class="tooltip">
                            <span class="tooltip-icon">i</span>
                            <span class="tooltip-text">Clique aqui caso precise alterar alguma informação da simulação, em seguida clique novamente em <strong>Simular</strong>.</span>
                        </div>
                    </div>
                </div>
                <div id="edit-notification" class="notification">Você já pode alterar os dados da simulação.</div>

                <div class="form-group">
                    <label for="client-cnpj">CNPJ:</label>
                    <div class="input-wrapper">
                        <input type="text" id="client-cnpj" required placeholder="Digite o CNPJ e tecle TAB">
                        <span id="cnpj-loading-message" class="hidden">Aguarde enquanto consultamos os dados...</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="client-name">Razão Social:</label>
                    <input type="text" id="client-name" required>
                </div>

                <div class="form-group">
                    <label for="client-fantasy-name">Nome Fantasia:</label>
                    <input type="text" id="client-fantasy-name">
                </div>

                <div class="form-group">
                    <label for="client-activity-start-date">Data de Início das Atividades:</label>
                    <input type="text" id="client-activity-start-date">
                </div>

                <div class="form-group">
                    <label for="client-legal-nature">Natureza Jurídica:</label>
                    <input type="text" id="client-legal-nature">
                </div>

                <div class="form-group">
                    <label for="client-main-activity">Atividade Principal da Empresa:</label>
                    <input type="text" id="client-main-activity">
                </div>

                <div class="form-group">
                    <label for="client-address">Endereço:</label>
                    <input type="text" id="client-address">
                </div>

                <div class="form-group">
                    <label for="client-partners">Sócio(s):</label>
                    <textarea id="client-partners" rows="4"></textarea>
                </div>

                <div class="form-group">
                    <label for="proposal-date">Data da proposta:</label>
                    <input type="date" id="proposal-date" required>
                </div>

                <hr>

                <h3>Dados da Operação</h3>

                <div class="form-group">
                    <label for="loan-amount">Valor a Financiar (R$):</label>
                    <input type="text" id="loan-amount" placeholder="50.000,00" required>
                </div>

                <div class="form-group">
                    <label for="grace-period">Carência (dias):</label>
                    <input type="number" id="grace-period" placeholder="Ex: 180" required>
                </div>

                <div class="form-group">
                    <label for="base-date">Data-Base:</label>
                    <div class="input-with-icon-wrapper">
                        <input type="number" id="base-date" placeholder="Dia do mês (1-28)" required min="1" max="28">
                        <span id="base-date-icon" class="input-icon hidden"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="installments">Parcelas (meses):</label>
                    <input type="number" id="installments" placeholder="Ex: 24" required min="1">
                </div>

                <div class="form-group">
                    <label for="first-payment-date">Data 1ª Parcela:</label>
                    <input type="date" id="first-payment-date" required readonly>
                    <div id="date-change-confirmation" class="confirmation-dialog hidden">
                        <p>Atenção: você alterou a data da 1ª Parcela. Dessa forma, a data inserida no campo "Data-Base" será desconsiderada. Confirma a alteração?</p>
                        <button type="button" id="confirm-date-change-btn">SIM</button>
                        <button type="button" id="cancel-date-change-btn">NÃO</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="partners-qty">Quantidade de Sócios:</label>
                    <input type="number" id="partners-qty" readonly>
                </div>

                <div class="form-group">
                    <label for="contract-rate">Sobretaxa (% a.a.):</label>
                    <input type="text" id="contract-rate" placeholder="15,50" required>
                </div>

                <div class="form-group">
                    <label for="cdi-rate">CDI anual (% a.a.):</label>
                    <input type="text" id="cdi-rate" placeholder="11,25" required>
                </div>

                <div class="form-group">
                    <label for="tac-amount">TAC (R$):</label>
                    <input type="text" id="tac-amount" placeholder="5.000,00" required>
                </div>

                <div class="form-group">
                    <button type="button" id="toggle-insurance-btn" class="toggle-btn">Incluir Seguro Prestamista</button>
                </div>

                <div class="form-actions">
                    <button type="button" id="calculate-btn">Simular</button>
                </div>
            </form>
        </section>

        <section id="results-area" class="hidden">
            <h2>Resultado da Simulação</h2>

            <div id="summary">
                <h3>Resumo da Operação</h3>
                <p><strong>Cliente:</strong> <span id="summary-client-name"></span></p>
                <p><strong>CNPJ:</strong> <span id="summary-client-cnpj"></span></p>
                <p><strong>Taxa de Juros Efetiva:</strong> <span id="summary-monthly-rate"></span></p>
                <p><strong>Custo Efetivo Total (CET) ao mês:</strong> <span id="summary-cet-monthly"></span></p>
                <p><strong>Custo Efetivo Total (CET) ao ano:</strong> <span id="summary-cet-annual"></span></p>
                <h4>Custos Iniciais (Pagos na Liberação)</h4>
                <p><strong>TAC:</strong> <span id="summary-tac"></span></p>
                <p><strong>ECG:</strong> <span id="summary-ecg"></span></p>
                <p><strong>IOF:</strong> <span id="summary-iof"></span></p>
                <p><strong>1ª Parcela do Seguro:</strong> <span id="summary-insurance"></span></p>
                <p><strong>Total dos Custos Iniciais:</strong> <span id="summary-total-costs"></span></p>
            </div>

            <div id="schedule">
                <h3>Cronograma de Pagamentos</h3>
                <table id="schedule-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Data</th>
                            <th>Capital (Amortização)</th>
                            <th>Juros</th>
                            <th>Prestamista</th>
                            <th>Valor a Pagar</th>
                            <th>Saldo Devedor</th>
                        </tr>
                    </thead>
                    <tbody id="schedule-body">
                        </tbody>
                </table>
            </div>

            <div id="disclaimer-container">
                <hr class="disclaimer-line">
                <p id="disclaimer-text" class="disclaimer-text"></p>
            </div>

             <div class="form-actions">
                <button type="button" id="export-pdf-btn">Exportar para PDF</button>
            </div>
        </section>

    </main>

    <footer id="app-footer">
        <!-- O conteúdo do rodapé será inserido dinamicamente via JavaScript -->
    </footer>

    <!-- Bibliotecas Externas -->
    <script src="https://unpkg.com/imask"></script> <!-- Para máscaras de input -->
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script> <!-- Para PDF -->
    <script src="https://unpkg.com/jspdf-autotable@latest/dist/jspdf.plugin.autotable.min.js"></script> <!-- Para tabelas no PDF -->

    <!-- Script Principal da Aplicação -->
    <script type="module" src="script.js"></script>

</body>
</html>
